---
const title = "VisionAI - AI-Powered Image Classification";
const description = "Train custom image classification models in your browser. Drag & drop your dataset, train with TensorFlow.js, and get instant predictions.";
---

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{title}</title>
	<meta name="description" content={description}>
	
	<!-- SEO Meta Tags -->
	<meta name="keywords" content="image classification, machine learning, AI, TensorFlow, computer vision, deep learning, neural network">
	<meta name="author" content="VisionAI">
	<meta name="robots" content="index, follow">
	
	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:title" content={title}>
	<meta property="og:description" content={description}>
	<meta property="og:image" content="/og-image.png">
	
	<!-- Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content={title}>
	<meta name="twitter:description" content={description}>
	
	<!-- Favicon -->
	<link rel="icon" type="image/svg+xml" href="/favicon.svg">
	
	<!-- Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
	<div class="app">
		<!-- Header -->
		<header class="header">
			<div class="container">
				<div class="logo-container">
					<svg class="logo-icon" viewBox="0 0 40 40" fill="none">
						<defs>
							<linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
								<stop offset="0%" style="stop-color:#0066ff"/>
								<stop offset="100%" style="stop-color:#00d4ff"/>
							</linearGradient>
						</defs>
						<circle cx="20" cy="20" r="18" stroke="url(#logoGradient)" stroke-width="2" fill="none"/>
						<circle cx="20" cy="20" r="8" fill="url(#logoGradient)"/>
						<circle cx="20" cy="20" r="4" fill="white"/>
						<path d="M8 20 L12 20 M28 20 L32 20 M20 8 L20 12 M20 28 L20 32" stroke="url(#logoGradient)" stroke-width="2" stroke-linecap="round"/>
					</svg>
					<h1 class="logo-text">VisionAI</h1>
				</div>
				<div class="status-badge" id="statusBadge">
					<span class="status-dot"></span>
					<span>Ready</span>
				</div>
			</div>
		</header>

		<!-- Hero Section -->
		<section class="hero">
			<div class="container">
				<div class="hero-content">
					<h2 class="hero-title">Train Your Own<br/><span class="gradient-text">Image Classifier</span></h2>
					<p class="hero-description">No coding required. Just drag & drop your images, and let AI do the magic.</p>
					<div class="hero-features">
						<div class="feature-badge">
							<svg viewBox="0 0 20 20" fill="currentColor">
								<path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6z"/>
							</svg>
							<span>Browser-based Training</span>
						</div>
						<div class="feature-badge">
							<svg viewBox="0 0 20 20" fill="currentColor">
								<path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/>
							</svg>
							<span>Real-time Results</span>
						</div>
						<div class="feature-badge">
							<svg viewBox="0 0 20 20" fill="currentColor">
								<path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z"/>
							</svg>
							<span>No Server Required</span>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Main Content -->
		<main class="main">
			<div class="container">
				<!-- Step 1: Upload Dataset -->
				<section class="card">
					<div class="card-header">
						<div class="step-badge">
							<span class="step-number">1</span>
						</div>
						<div class="card-title-group">
							<h3 class="card-title">Upload Training Data</h3>
							<p class="card-subtitle">Drag & drop a folder with images organized by class</p>
						</div>
					</div>
					
					<div class="upload-zone" id="uploadZone">
						<div class="upload-icon-wrapper">
							<svg class="upload-icon" viewBox="0 0 64 64" fill="none" stroke="currentColor">
								<path d="M52 48v8a4 4 0 01-4 4H16a4 4 0 01-4-4v-8M44 20L32 8 20 20M32 8v32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</div>
						<h4 class="upload-title">Drop your folder here</h4>
						<p class="upload-subtitle">or click to browse files</p>
						<div class="upload-hint">
							<svg viewBox="0 0 20 20" fill="currentColor">
								<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
							</svg>
							<span>Organize: MyData/class1/img1.jpg, MyData/class2/img2.jpg</span>
						</div>
						<input type="file" id="fileInput" multiple accept="image/*" hidden/>
					</div>

					<div class="dataset-summary" id="datasetSummary" style="display: none;">
						<div class="stats-grid">
							<div class="stat-card">

								<div class="stat-content">
									<div class="stat-value" id="totalImages">0</div>
									<div class="stat-label">Total Images</div>
								</div>
							</div>
							<div class="stat-card">

								<div class="stat-content">
									<div class="stat-value" id="totalClasses">0</div>
									<div class="stat-label">Classes</div>
								</div>
							</div>
						</div>
						<div class="class-pills" id="classTags"></div>
						<button class="btn-primary" id="startTrainBtn">
							<svg viewBox="0 0 20 20" fill="currentColor">
								<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/>
							</svg>
							<span>Start Training</span>
						</button>
					</div>
				</section>

				<!-- Step 2: Training Progress -->
				<section class="card" id="trainSection" style="display: none;">
					<div class="card-header">
						<div class="step-badge">
							<span class="step-number">2</span>
						</div>
						<div class="card-title-group">
							<h3 class="card-title">Training in Progress</h3>
							<p class="card-subtitle">Your model is learning from the data</p>
						</div>
					</div>

					<div class="training-progress">
						<div class="progress-ring">
							<svg class="progress-svg" viewBox="0 0 120 120">
								<circle class="progress-bg" cx="60" cy="60" r="54"/>
								<circle class="progress-bar" id="progressCircle" cx="60" cy="60" r="54"/>
							</svg>
							<div class="progress-content">
								<div class="progress-percent" id="progressPercent">0%</div>
								<div class="progress-label">Complete</div>
							</div>
						</div>
						<div class="progress-details">
							<div class="progress-text" id="progressText">Initializing...</div>
							<div class="progress-bar-linear">
								<div class="progress-fill" id="progressFill"></div>
							</div>
						</div>
					</div>
				</section>

				<!-- Step 3: Test Model -->
				<section class="card" id="testSection" style="display: none;">
					<div class="card-header">
						<div class="step-badge">
							<span class="step-number">3</span>
						</div>
						<div class="card-title-group">
							<h3 class="card-title">Test Your Model</h3>
							<p class="card-subtitle">Upload an image to see predictions</p>
						</div>
					</div>

					<div class="test-grid">
						<div class="test-upload-card" id="testUpload">
							<svg class="test-upload-icon" viewBox="0 0 64 64" fill="none" stroke="currentColor">
								<rect x="8" y="8" width="48" height="48" rx="4" stroke-width="3"/>
								<circle cx="22" cy="22" r="4"/>
								<path d="M56 40L44 28 20 52" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
							<p class="test-upload-text">Click to upload test image</p>
							<input type="file" id="testInput" accept="image/*" hidden/>
						</div>

						<div class="test-result-card" id="testResult" style="display: none;">
							<div class="result-image-wrapper">
								<img id="testImage" alt="Test image"/>
							</div>
							<div class="result-details">
								<div class="result-prediction">
									<div class="result-label">Prediction</div>
									<div class="result-class" id="resultClass"></div>
								</div>
								<div class="result-confidence-wrapper">
									<div class="result-label">Confidence</div>
									<div class="confidence-bar-wrapper">
										<div class="confidence-bar">
											<div class="confidence-fill" id="confidenceFill"></div>
										</div>
										<span class="confidence-text" id="confidenceText"></span>
									</div>
								</div>
								<div class="all-predictions" id="allPredictions"></div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</main>

		<!-- Footer -->
		<footer class="footer">
			<div class="container">
				<div class="footer-content">
					<div class="footer-brand">
						<svg class="footer-logo" viewBox="0 0 40 40" fill="none">
							<defs>
								<linearGradient id="footerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
									<stop offset="0%" style="stop-color:#0066ff"/>
									<stop offset="100%" style="stop-color:#00d4ff"/>
								</linearGradient>
							</defs>
							<circle cx="20" cy="20" r="18" stroke="url(#footerGradient)" stroke-width="2" fill="none"/>
							<circle cx="20" cy="20" r="8" fill="url(#footerGradient)"/>
							<circle cx="20" cy="20" r="4" fill="white"/>
						</svg>
						<span>VisionAI</span>
					</div>
					<p class="footer-text">Powered by <span class="kamy-text">KaMy</span></p>
				</div>
			</div>
		</footer>
	</div>

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		:root {
			--bg: #0a0a0a;
			--surface: #141414;
			--surface-elevated: #1a1a1a;
			--border: #2a2a2a;
			--text: #ffffff;
			--text-secondary: #a0a0a0;
			--text-muted: #666666;
			--primary: #0066ff;
			--primary-hover: #0052cc;
			--success: #00ff88;
			--gradient: linear-gradient(135deg, #0066ff 0%, #00d4ff 100%);
			--radius: 16px;
			--shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
		}

		body {
			background: var(--bg);
			color: var(--text);
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			line-height: 1.6;
			-webkit-font-smoothing: antialiased;
		}

		.app {
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 0 24px;
			width: 100%;
		}

		/* Header */
		.header {
			background: rgba(20, 20, 20, 0.8);
			backdrop-filter: blur(20px);
			border-bottom: 1px solid var(--border);
			padding: 16px 0;
			position: sticky;
			top: 0;
			z-index: 100;
		}

		.header .container {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.logo-container {
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.logo-icon {
			width: 40px;
			height: 40px;
		}

		.logo-text {
			font-size: 24px;
			font-weight: 800;
			background: var(--gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.status-badge {
			display: flex;
			align-items: center;
			gap: 8px;
			background: var(--surface-elevated);
			border: 1px solid var(--border);
			padding: 8px 16px;
			border-radius: 24px;
			font-size: 14px;
		}

		.status-dot {
			width: 8px;
			height: 8px;
			background: var(--success);
			border-radius: 50%;
			animation: pulse 2s infinite;
		}

		@keyframes pulse {
			0%, 100% { opacity: 1; }
			50% { opacity: 0.5; }
		}

		/* Hero */
		.hero {
			padding: 80px 0 60px;
			text-align: center;
		}

		.hero-title {
			font-size: 56px;
			font-weight: 800;
			line-height: 1.1;
			margin-bottom: 20px;
			letter-spacing: -0.02em;
		}

		.gradient-text {
			background: var(--gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.hero-description {
			font-size: 20px;
			color: var(--text-secondary);
			margin-bottom: 32px;
			max-width: 600px;
			margin-left: auto;
			margin-right: auto;
		}

		.hero-features {
			display: flex;
			gap: 16px;
			justify-content: center;
			flex-wrap: wrap;
		}

		.feature-badge {
			display: flex;
			align-items: center;
			gap: 8px;
			background: var(--surface-elevated);
			border: 1px solid var(--border);
			padding: 10px 20px;
			border-radius: 24px;
			font-size: 14px;
			color: var(--text-secondary);
		}

		.feature-badge svg {
			width: 16px;
			height: 16px;
			color: var(--primary);
		}

		/* Main */
		.main {
			flex: 1;
			padding: 40px 0 80px;
		}

		.card {
			background: var(--surface);
			border: 1px solid var(--border);
			border-radius: var(--radius);
			padding: 32px;
			margin-bottom: 24px;
			box-shadow: var(--shadow);
		}

		.card-header {
			display: flex;
			gap: 20px;
			margin-bottom: 32px;
		}

		.step-badge {
			width: 56px;
			height: 56px;
			background: var(--gradient);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-shrink: 0;
			box-shadow: 0 4px 16px rgba(0, 102, 255, 0.3);
		}

		.step-number {
			font-size: 24px;
			font-weight: 700;
			color: white;
		}

		.card-title {
			font-size: 24px;
			font-weight: 700;
			margin-bottom: 4px;
		}

		.card-subtitle {
			color: var(--text-secondary);
			font-size: 14px;
		}

		/* Upload Zone */
		.upload-zone {
			border: 2px dashed var(--border);
			border-radius: var(--radius);
			padding: 64px 32px;
			text-align: center;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			background: var(--surface-elevated);
		}

		.upload-zone:hover, .upload-zone.drag-over {
			border-color: var(--primary);
			background: rgba(0, 102, 255, 0.05);
			transform: translateY(-2px);
		}

		.upload-icon-wrapper {
			margin-bottom: 24px;
		}

		.upload-icon {
			width: 64px;
			height: 64px;
			color: var(--text-muted);
			margin: 0 auto;
		}

		.upload-title {
			font-size: 20px;
			font-weight: 600;
			margin-bottom: 8px;
		}

		.upload-subtitle {
			color: var(--text-secondary);
			font-size: 14px;
			margin-bottom: 20px;
		}

		.upload-hint {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			background: var(--surface);
			padding: 8px 16px;
			border-radius: 20px;
			font-size: 12px;
			color: var(--text-muted);
		}

		.upload-hint svg {
			width: 16px;
			height: 16px;
		}

		/* Dataset Summary */
		.dataset-summary {
			margin-top: 32px;
			padding-top: 32px;
			border-top: 1px solid var(--border);
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 16px;
			margin-bottom: 24px;
		}

		.stat-card {
			background: var(--surface-elevated);
			border: 1px solid var(--border);
			border-radius: 12px;
			padding: 20px;
			display: flex;
			align-items: center;
			gap: 16px;
		}

		.stat-icon {
			font-size: 32px;
		}

		.stat-value {
			font-size: 32px;
			font-weight: 700;
			background: var(--gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			line-height: 1;
			margin-bottom: 4px;
		}

		.stat-label {
			font-size: 12px;
			color: var(--text-muted);
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.class-pills {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			margin-bottom: 24px;
		}

		.class-pill {
			background: var(--surface-elevated);
			border: 1px solid var(--border);
			padding: 10px 18px;
			border-radius: 20px;
			font-size: 14px;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.class-pill strong {
			background: var(--gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		/* Button */
		.btn-primary {
			background: var(--gradient);
			color: white;
			border: none;
			padding: 16px 32px;
			border-radius: 12px;
			font-size: 16px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			width: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 10px;
			box-shadow: 0 4px 16px rgba(0, 102, 255, 0.3);
		}

		.btn-primary svg {
			width: 20px;
			height: 20px;
		}

		.btn-primary:hover:not(:disabled) {
			transform: translateY(-2px);
			box-shadow: 0 6px 24px rgba(0, 102, 255, 0.4);
		}

		.btn-primary:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		/* Training Progress */
		.training-progress {
			display: grid;
			grid-template-columns: auto 1fr;
			gap: 40px;
			align-items: center;
		}

		.progress-ring {
			position: relative;
			width: 120px;
			height: 120px;
		}

		.progress-svg {
			transform: rotate(-90deg);
		}

		.progress-bg {
			fill: none;
			stroke: var(--surface-elevated);
			stroke-width: 8;
		}

		.progress-bar {
			fill: none;
			stroke: url(#logoGradient);
			stroke-width: 8;
			stroke-linecap: round;
			stroke-dasharray: 339.292;
			stroke-dashoffset: 339.292;
			transition: stroke-dashoffset 0.3s;
		}

		.progress-content {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			text-align: center;
		}

		.progress-percent {
			font-size: 24px;
			font-weight: 700;
			background: var(--gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.progress-label {
			font-size: 11px;
			color: var(--text-muted);
			text-transform: uppercase;
		}

		.progress-details {
			flex: 1;
		}

		.progress-text {
			font-size: 16px;
			color: var(--text-secondary);
			margin-bottom: 12px;
		}

		.progress-bar-linear {
			height: 8px;
			background: var(--surface-elevated);
			border-radius: 4px;
			overflow: hidden;
		}

		.progress-fill {
			height: 100%;
			background: var(--gradient);
			transition: width 0.3s;
			width: 0%;
		}

		/* Test Grid */
		.test-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 24px;
		}

		.test-upload-card {
			border: 2px dashed var(--border);
			border-radius: var(--radius);
			padding: 64px 32px;
			text-align: center;
			cursor: pointer;
			transition: all 0.3s;
			background: var(--surface-elevated);
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			min-height: 400px;
		}

		.test-upload-card:hover {
			border-color: var(--primary);
			background: rgba(0, 102, 255, 0.05);
			transform: translateY(-2px);
		}

		.test-upload-icon {
			width: 64px;
			height: 64px;
			color: var(--text-muted);
			margin-bottom: 20px;
		}

		.test-upload-text {
			color: var(--text-secondary);
			font-size: 16px;
		}

		.test-result-card {
			background: var(--surface-elevated);
			border: 1px solid var(--border);
			border-radius: var(--radius);
			overflow: hidden;
		}

		.result-image-wrapper {
			width: 100%;
			height: 300px;
			overflow: hidden;
		}

		.result-image-wrapper img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.result-details {
			padding: 24px;
		}

		.result-label {
			font-size: 11px;
			color: var(--text-muted);
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-bottom: 8px;
		}

		.result-class {
			font-size: 32px;
			font-weight: 700;
			background: var(--gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			margin-bottom: 20px;
		}

		.confidence-bar-wrapper {
			margin-bottom: 24px;
		}

		.confidence-bar {
			height: 8px;
			background: var(--surface);
			border-radius: 4px;
			overflow: hidden;
			margin-bottom: 8px;
		}

		.confidence-fill {
			height: 100%;
			background: var(--success);
			transition: width 0.3s;
			width: 0%;
		}

		.confidence-text {
			font-size: 14px;
			color: var(--text-secondary);
		}

		.all-predictions {
			padding-top: 20px;
			border-top: 1px solid var(--border);
		}

		.all-predictions h4 {
			font-size: 12px;
			color: var(--text-muted);
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-bottom: 12px;
		}

		.prediction-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 8px 0;
			font-size: 14px;
		}

		.prediction-item .name {
			color: var(--text);
		}

		.prediction-item .score {
			color: var(--text-muted);
			font-weight: 600;
		}

		/* Footer */
		.footer {
			background: var(--surface);
			border-top: 1px solid var(--border);
			padding: 32px 0;
			margin-top: auto;
		}

		.footer-content {
			text-align: center;
		}

		.footer-brand {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 12px;
			margin-bottom: 12px;
		}

		.footer-logo {
			width: 32px;
			height: 32px;
		}

		.footer-brand span {
			font-size: 18px;
			font-weight: 700;
			background: var(--gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.footer-text {
			color: var(--text-muted);
			font-size: 14px;
		}

	.kamy-text {
		font-weight: 700;
		font-size: 16px;
		background: var(--gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
		letter-spacing: 0.5px;
	}

		@media (max-width: 768px) {
			.hero-title {
				font-size: 40px;
			}

			.test-grid {
				grid-template-columns: 1fr;
			}

			.training-progress {
				grid-template-columns: 1fr;
				text-align: center;
			}

			.progress-ring {
				margin: 0 auto;
			}
		}
	</style>

	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>

	<script is:inline>
		let uploadedDataset = {};
		let trainedModel = null;
		let classNames = [];

		const uploadZone = document.getElementById('uploadZone');
		const fileInput = document.getElementById('fileInput');
		const datasetSummary = document.getElementById('datasetSummary');
		const startTrainBtn = document.getElementById('startTrainBtn');

		uploadZone.addEventListener('click', () => fileInput.click());

		fileInput.addEventListener('change', (e) => {
			const files = Array.from(e.target.files || []);
			processFiles(files);
		});

		uploadZone.addEventListener('dragover', (e) => {
			e.preventDefault();
			e.stopPropagation();
			uploadZone.classList.add('drag-over');
		});

		uploadZone.addEventListener('dragleave', (e) => {
			e.preventDefault();
			e.stopPropagation();
			uploadZone.classList.remove('drag-over');
		});

		uploadZone.addEventListener('drop', async (e) => {
			e.preventDefault();
			e.stopPropagation();
			uploadZone.classList.remove('drag-over');

			const items = e.dataTransfer.items;
			const files = [];

			for (let i = 0; i < items.length; i++) {
				const item = items[i].webkitGetAsEntry();
				if (item) {
					await traverseFileTree(item, files);
				}
			}

			if (files.length > 0) {
				processFiles(files);
			}
		});

		async function traverseFileTree(item, files, path = '') {
			return new Promise((resolve) => {
				if (item.isFile) {
					item.file((file) => {
						if (file.type.startsWith('image/')) {
							file.folderPath = path;
							files.push(file);
						}
						resolve();
					});
				} else if (item.isDirectory) {
					const dirReader = item.createReader();
					dirReader.readEntries(async (entries) => {
						for (const entry of entries) {
							await traverseFileTree(entry, files, path + item.name + '/');
						}
						resolve();
					});
				}
			});
		}

		function processFiles(files) {
			uploadedDataset = {};

			files.forEach(file => {
				let className = 'unlabeled';
				
				if (file.folderPath) {
					const parts = file.folderPath.split('/').filter(p => p);
					if (parts.length > 0) {
						className = parts[parts.length - 1];
					}
				}

				if (!uploadedDataset[className]) {
					uploadedDataset[className] = [];
				}
				uploadedDataset[className].push(file);
			});

			const classes = Object.keys(uploadedDataset);
			const totalImages = Object.values(uploadedDataset).reduce((sum, imgs) => sum + imgs.length, 0);

			if (classes.length >= 1 && totalImages > 0) {
				classNames = classes;
				document.getElementById('totalImages').textContent = totalImages;
				document.getElementById('totalClasses').textContent = classes.length;
				
				const classTags = document.getElementById('classTags');
				classTags.innerHTML = classes
					.map(name => `<div class="class-pill"><strong>${name}</strong><span>${uploadedDataset[name].length} images</span></div>`)
					.join('');

				datasetSummary.style.display = 'block';
			}
		}

		startTrainBtn.addEventListener('click', async () => {
			document.getElementById('trainSection').style.display = 'block';
			setTimeout(() => {
				document.getElementById('trainSection').scrollIntoView({ behavior: 'smooth' });
			}, 100);

			const xs = [];
			const ys = [];

			for (let i = 0; i < classNames.length; i++) {
				const className = classNames[i];
				const images = uploadedDataset[className];

				for (const file of images) {
					const img = await loadImage(file);
					xs.push(img);
					ys.push(i);
				}
			}

			const model = tf.sequential({
				layers: [
					tf.layers.flatten({ inputShape: [224, 224, 3] }),
					tf.layers.dense({ units: 128, activation: 'relu' }),
					tf.layers.dropout({ rate: 0.2 }),
					tf.layers.dense({ units: classNames.length, activation: 'softmax' })
				]
			});

			model.compile({
				optimizer: 'adam',
				loss: 'categoricalCrossentropy',
				metrics: ['accuracy']
			});

			const xsTensor = tf.stack(xs);
			const ysTensor = tf.oneHot(tf.tensor1d(ys, 'int32'), classNames.length);

			const circumference = 2 * Math.PI * 54;
			const progressCircle = document.getElementById('progressCircle');

			await model.fit(xsTensor, ysTensor, {
				epochs: 10,
				callbacks: {
					onEpochEnd: (epoch, logs) => {
						const progress = ((epoch + 1) / 10) * 100;
						const offset = circumference - (progress / 100) * circumference;
						
						progressCircle.style.strokeDashoffset = offset;
						document.getElementById('progressFill').style.width = progress + '%';
						document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
						document.getElementById('progressText').textContent = `Epoch ${epoch + 1}/10 - Loss: ${logs.loss.toFixed(4)} - Accuracy: ${(logs.acc * 100).toFixed(1)}%`;
					}
				}
			});

			trainedModel = model;
			document.getElementById('progressText').textContent = 'Training complete! Ready to test.';
			document.getElementById('testSection').style.display = 'block';
			
			setTimeout(() => {
				document.getElementById('testSection').scrollIntoView({ behavior: 'smooth' });
			}, 500);

			xsTensor.dispose();
			ysTensor.dispose();
		});

		async function loadImage(file) {
			return new Promise((resolve) => {
				const reader = new FileReader();
				reader.onload = (e) => {
					const img = new Image();
					img.onload = () => {
						const tensor = tf.browser.fromPixels(img)
							.resizeBilinear([224, 224])
							.toFloat()
							.div(255.0);
						resolve(tensor);
					};
					img.src = e.target.result;
				};
				reader.readAsDataURL(file);
			});
		}

		const testUpload = document.getElementById('testUpload');
		const testInput = document.getElementById('testInput');
		const testResult = document.getElementById('testResult');

		testUpload.addEventListener('click', () => testInput.click());

		testInput.addEventListener('change', async (e) => {
			const file = e.target.files[0];
			if (file && trainedModel) {
				const reader = new FileReader();
				reader.onload = async (e) => {
					const img = document.getElementById('testImage');
					img.src = e.target.result;
					
					const testImg = new Image();
					testImg.onload = async () => {
						const tensor = tf.browser.fromPixels(testImg)
							.resizeBilinear([224, 224])
							.toFloat()
							.div(255.0)
							.expandDims(0);

						const predictions = await trainedModel.predict(tensor);
						const probabilities = await predictions.data();
						const maxIndex = probabilities.indexOf(Math.max(...Array.from(probabilities)));
						const confidence = probabilities[maxIndex] * 100;

						document.getElementById('resultClass').textContent = classNames[maxIndex];
						document.getElementById('confidenceFill').style.width = confidence + '%';
						document.getElementById('confidenceText').textContent = `${confidence.toFixed(1)}% confidence`;

						const allPreds = document.getElementById('allPredictions');
						allPreds.innerHTML = '<h4>All Predictions</h4>' +
							classNames
								.map((name, i) => `
									<div class="prediction-item">
										<span class="name">${name}</span>
										<span class="score">${(probabilities[i] * 100).toFixed(1)}%</span>
									</div>
								`)
								.join('');

						testResult.style.display = 'block';

						tensor.dispose();
						predictions.dispose();
					};
					testImg.src = e.target.result;
				};
				reader.readAsDataURL(file);
			}
		});
	</script>
</body>
</html>
